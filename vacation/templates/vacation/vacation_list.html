{% extends 'layout.html' %}
{% block title %}Vacation List{% endblock %}

{% block content %}
  <h2 class="mb-4 text-center">Vacation List</h2>
  <br>
  <br>

  {% if request.user.is_superuser %}
    <div class="text-center mb-3">
      <a href="{% url 'add_vacation' %}" class="btn btn-primary">+ Add Vacation</a>
    </div>
  {% endif %}
  <br>
  <br>

  <form method="get" class="d-flex mb-4" style="max-width: 400px;">
  <select name="country" class="form-select me-2">
    <option value="">-- Select Country --</option>
    {% for country in countries %}
      <option value="{{ country.id }}" {% if request.GET.country == country.id|stringformat:"s" %}selected{% endif %}>
        {{ country.name }}
      </option>
    {% endfor %}
  </select>
  <button type="submit" class="btn btn-outline-primary">Search</button>
</form>

  {% if vacations %}
    <div class="table-responsive">
      <table class="table table-bordered table-striped align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Image</th>
            <th>Country</th>
            <th>Description</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Price</th>
            <th>Liked By</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for vacation in vacations %}
            <tr>
              <td>
                {% if vacation.image %}
                  <div class="vacation-img-wrapper">
                    <img src="{{ vacation.image.url }}" alt="{{ vacation.description }}" class="vacation-img">
                  </div>
                {% else %}
                  No Image
                {% endif %}
              </td>
              <td>{{ vacation.country.name }}</td>
              <td>{{ vacation.description }}</td>
              <td>{{ vacation.start_date }}</td>
              <td>{{ vacation.end_date }}</td>
              <td>${{ vacation.price }}</td>
              <td>
                {{ vacation.liked_by.count }} ‚ù§Ô∏è<br>
                {% for user in vacation.liked_by.all %}
                  <small>{{ user.username }}</small>{% if not forloop.last %}, {% endif %}
                {% endfor %}
              </td>
              <td>
                <div class="d-flex justify-content-center gap-2">
                {% if user.is_authenticated %}
                  <form method="post" action="{% url 'like_vacation' vacation.pk %}">
                    {% csrf_token %}
                    {% if user in vacation.liked_by.all %}
                      <button type="submit" class="btn btn-sm btn-danger">Unlike ‚ù§Ô∏è</button>
                    {% else %}
                      <button type="submit" class="btn btn-sm btn-outline-danger">Like ü§ç</button>
                    {% endif %}
                  </form>
                {% else %}
                  <small class="text-muted">Login to like</small>
                {% endif %}
                 {% if request.user.is_superuser %}
                  <a href="{% url 'update_vacation' vacation.pk %}" class="btn btn-sm btn-warning">Edit</a>
                  <a href="{% url 'delete_vacation' vacation.pk %}" class="btn btn-sm btn-danger">Delete</a>
                  
                {% endif %}

               </div> 
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info text-center">No vacations found.</div>
  {% endif %}
{% endblock %}
